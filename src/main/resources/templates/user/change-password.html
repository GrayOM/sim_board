<!-- src/main/resources/templates/user/change-password.html -->
<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head th:replace="layout/header :: head('비밀번호 변경')">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>비밀번호 변경</title>
</head>
<body>
<header th:replace="layout/header :: header"></header>
<div class="container mt-5">
    <div class="card">
        <div class="card-header bg-primary text-white">
            <h3><i class="fas fa-key me-2"></i>비밀번호 변경</h3>
        </div>
        <div class="card-body">
            <form th:action="@{/user/change-password}" th:object="${passwordChangeDto}" method="post">
                <div class="mb-3">
                    <label for="currentPassword" class="form-label">현재 비밀번호</label>
                    <input type="password" class="form-control" id="currentPassword" th:field="*{currentPassword}" required>
                    <div class="text-danger" th:if="${#fields.hasErrors('currentPassword')}" th:errors="*{currentPassword}"></div>
                </div>

                <div class="mb-3">
                    <label for="newPassword" class="form-label">새 비밀번호</label>
                    <input type="password" class="form-control" id="newPassword" th:field="*{newPassword}" required>
                    <div class="text-danger" th:if="${#fields.hasErrors('newPassword')}" th:errors="*{newPassword}"></div>
                    <div class="form-text">비밀번호는 8자 이상, 영문 대소문자, 숫자, 특수문자를 포함해야 합니다.</div>
                </div>

                <div class="mb-3">
                    <label for="confirmPassword" class="form-label">비밀번호 확인</label>
                    <input type="password" class="form-control" id="confirmPassword" th:field="*{confirmPassword}" required>
                    <div class="text-danger" th:if="${#fields.hasErrors('confirmPassword')}" th:errors="*{confirmPassword}"></div>
                </div>

                <div class="d-flex justify-content-between">
                    <a th:href="@{/boards}" class="btn btn-secondary">취소</a>
                    <button type="submit" class="btn btn-primary">비밀번호 변경</button>
                </div>
            </form>
        </div>
    </div>
</div>
<footer th:replace="layout/footer :: footer"></footer>

<script>
    // 비밀번호 복잡도 검사 함수
    function checkPasswordStrength(password) {
        const minLength = 8;
        const hasLowercase = /[a-z]/.test(password);
        const hasUppercase = /[A-Z]/.test(password);
        const hasDigit = /\d/.test(password);
        const hasSpecial = /[@$!%*?&]/.test(password);

        let strength = 0;
        if (password.length >= minLength) strength++;
        if (hasLowercase) strength++;
        if (hasUppercase) strength++;
        if (hasDigit) strength++;
        if (hasSpecial) strength++;

        return strength;
    }

    // 비밀번호 필드에 이벤트 리스너 추가
    document.getElementById('newPassword').addEventListener('input', function() {
        const password = this.value;
        const strength = checkPasswordStrength(password);
        const feedback = document.createElement('div');
        feedback.id = 'password-strength';

        let strengthText = '';
        let strengthClass = '';

        if (strength < 3) {
            strengthText = '약함';
            strengthClass = 'text-danger';
        } else if (strength < 5) {
            strengthText = '보통';
            strengthClass = 'text-warning';
        } else {
            strengthText = '강함';
            strengthClass = 'text-success';
        }

        feedback.innerHTML = `비밀번호 강도: <span class="${strengthClass}">${strengthText}</span>`;

        // 기존 피드백 제거
        const existingFeedback = document.getElementById('password-strength');
        if (existingFeedback) {
            existingFeedback.remove();
        }

        // 새 피드백 추가
        this.parentNode.appendChild(feedback);
    });
</script>
</body>
</html>